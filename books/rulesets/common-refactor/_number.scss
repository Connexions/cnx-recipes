@import "./utils";

@mixin numberChapters($chapterTitleContent) {
  div[data-type="chapter"] {
    @include title($chapterTitleContent, bChapterLabel);
    //use the title mixin for this? and that way content() can be wrapped
    > [data-type="document-title"] {
      container: h1;
      content: pending(bChapterLabel) content();
    }
  }
}

@mixin numberAppendices($appendixTitleContent) {
  div.appendix {
    @include title($appendixTitleContent, bAppendixLabel);
    //use the title mixin for this? and that way content() can be wrapped
    > [data-type="document-title"] {
      container: h1;
      content: pending(bAppendixLabel) content();
    }
  }
}

@mixin numberSections($sectionTitleContent) {
  div[data-type="chapter"] > div[data-type="page"] {
    &:not(.introduction) {
      @include title($sectionTitleContent, bSectionLabel);
      //use the title mixin for this? and that way content() can be wrapped
      > [data-type="document-title"] {
        container: h2;
        content: pending(bSectionLabel) content();
      }
    }
    &.introduction {
      > [data-type="document-title"] {
        container: h2;
      }
    }
  }
}

//EOC composite pages must be created before this runs
@mixin numberEOCExercises($exerciseTitleContent, $solutionTitleContent) {
  .eoc [data-type="exercise"] {
    [data-type="problem"] {
      @include title($exerciseTitleContent);
    }
    [data-type="solution"] {
      @include title($exerciseTitleContent);
    }
  }
}

@mixin numberExamples($exampleTitleContent, $solutionTitleContent) {
  .example {
    @include title($exampleTitleContent, bExampleLabel);
    > [data-type="title"] {
      //BAD: there should not be titling content creation outside the book level. This should get moved
      $exampleTitle: (
        text: content()
      );
      @include title($exampleTitle, bExampleLabel);
      move-to: trash;
    }
    &::after {
      container: div;
      content: pending(bExampleLabel);
      class: "title";
      move-to: bExampleHeader;
    }
    &:deferred {
      content: pending(bExampleHeader) content();
    }
    [data-type="solution"] {
      @include title($solutionTitleContent, null, div, "solution-title");
    }
  }
}

@mixin numberNote($type, $noteContent) { 
  [data-type="note"].#{$type} {
    @include title($noteContent, bNoteLabel-#{$type});
    > [data-type="title"] {
      //TODO: May want to have the option to preserve titles similarly to examples in the future.
      move-to: trash;
    }
    &::after {
      container: div;
      content: pending(bNoteLabel-#{$type});
      class: "title";
      move-to: bNoteHeader;
    }
    &:deferred {
      content: pending(bNoteHeader) content();
    }
    //TODO: Maybe want to have the option to handle solutions similarly to examples in the future
  }
}

@mixin setCaptions($setFigTableCaptions, $labeling, $labelingAp) {
  $type: map-get($setFigTableCaptions, type);
  $defaultContainer: map-get($setFigTableCaptions, defaultContainer);
  $hasCaption: map-get($setFigTableCaptions, hasCaption);
  $hasTitle: map-get($setFigTableCaptions, hasTitle);
  [data-type="chapter"] {
    :not(#{$type}) > #{$type} {
      @include title($labeling, bCaption);
      @include setCaptionsHelper($type, $defaultContainer, $hasCaption, $hasTitle);
    }
  }
  .appendix {
    :not(#{$type}) > #{$type} {
      @include title($labelingAp, bCaption);
      @include setCaptionsHelper($type, $defaultContainer, $hasCaption, $hasTitle);
    }
  }
}

@mixin setCaptionsHelper($type, $defaultContainer, $hasCaption, $hasTitle) {
  @if ($hasCaption) {
    #{$defaultContainer} {
      container: span;
      class: "caption";
      move-to: bCaption;
    }
  }
  @if ($hasTitle) {
    #{$defaultContainer} [data-type="title"] {
      container: span;
      class: "title";
      move-to: bCaption;
    }
  }
  &::after {
    container: div;
    class: "captionContainer";
    content: pending(bCaption);
    move-to: bCaptionContainer;
  }
  &::outside {
    class: #{$type};
    container: div;
    content: content() pending(bCaptionContainer);
  }
}
