body {
  > div[data-type="page"]:pass(60), > div[data-type="composite-page"]:pass(60) {
    string-set: page-id attr(id);
    > [data-type='document-title'] {
      node-set: pageTitle;
    }
    &::after {
      content: nodes(pageTitle);
      attr-href: "#" string(page-id);
      container: a;
      move-to: page-link;
    }
    &::after {
      content: pending(page-link);
      move-to: eob-toc;
      container: li;
    }
  }
  > div[data-type='chapter']:pass(60) {
    > h1[data-type='document-title'] {
      node-set: chapterTitle;
      string-set: chapTitle-id attr(id);
    }
    &::after {
      content: nodes(chapterTitle);
      attr-href: "#" string(chapTitle-id);
      container: a;
      move-to: eoc-toc;
    }
    > div[data-type="page"], > div[data-type="composite-page"] {
      string-set: page-id-chap attr(id);
      > [data-type='document-title'] {
        node-set: PageTitle;
      }
      &::after {
        content: nodes(PageTitle);
        attr-href: "#" string(page-id-chap);
        container: a;
        move-to: page-link;
      }
      &::after {
        content: pending(page-link);
        move-to: eoc-toc-pages;
        container: li;
      }
    }
    &::after {
      content: pending(eoc-toc-pages);
      container: ol;
      class: chapter;
      move-to: eoc-toc;
    }
    &::after {
      content: pending(eoc-toc);
      container: li;
      move-to: eob-toc;
    }
  }
  > div[data-type="unit"]:pass(60) {
    > h1[data-type='document-title'] {
      copy-to: eou-toc;
    }
    > div[data-type='chapter'] {
      > h1[data-type='document-title'] {
        // container: h1;
        // data-type: "toc-title";
        copy-to: eoc-toc;
      }
      > div[data-type="page"], div[data-type="composite-page"] {
        > h2[data-type='document-title'] {
          copy-to: page-title;
        }
        &::after {
          content: pending(page-title);
          move-to: eoc-toc-pages;
          container: li;
        }
      }
      &::after {
        content: pending(eoc-toc-pages);
        container: ol;
        class: chapter;
        move-to: eoc-toc;
      }
      &::after {
        content: pending(eoc-toc);
        container: li;
        move-to: eou-toc-chapters;
      }
    }
    &::after {
      content: pending(eou-toc-chapters);
      container: ol;
      class: unit;
      move-to: eou-toc;
    }
    &::after {
      content: pending(eou-toc);
      container: li;
      move-to: eob-toc;
    }
  }
}

nav#toc:pass(65) {
  content: '';
  &::after {
    content: pending(eob-toc);
    container: ol;
  }
}

nav#toc > ol:pass(66) {
  li {
    > a {
      move-to: trash;
      string-set: toc-ref attr(href);
      //Refactor: We are moving towards not using divs as doc-title containers, try to remove >div>span
      // > div > span,
      > h1 > span,
      > h2 > span,
      > div > span {
        move-to: title-spans;
      }
      //Refactor: This puts an <a> inside an <a>? There might be a better solution (maybe deferred?)
      // &:deferred {
      //   container: a;
      //   content: pending(title-spans);
      //   attr-href: string(toc-ref);
      // }
      &::outside {
        content: pending(title-spans);
        container: a;
        attr-href: string(toc-ref);
      }
    }
  }
}
