#!/bin/sh
set -e


BOOK_NAME=$1
DEBUG_FLAG1=$2 # could be --debug or --verbose (or both)
DEBUG_FLAG2=$3

CSS_PATH="./books/rulesets/output/${BOOK_NAME}.css"
RAW_PATH="./data/${BOOK_NAME}-raw.html"
LCOV_PATH="./data/${BOOK_NAME}.lcov"

# Check command line args

if [ -z "${BOOK_NAME}" ]
then
  echo 'ERROR: Argument Missing. You must specify the name of the book as the 1st argument. For example: physics'
  exit 1
fi

if [ ! -f "${CSS_PATH}" ]
then
  echo "ERROR: CSS File missing at ${CSS_PATH}"
  exit 1
fi

if [ ! -f "${RAW_PATH}" ]
then
  echo "ERROR: HTML File missing at ${RAW_PATH}"
  exit 1
fi


# Print out the message first because css-coverage will set
# a non-zero exit status if there are unused selectors
# and the `set -e` at the top of this script will exit at that point

echo "Coverage is being generated. To see an HTML version, run the following:"
echo "genhtml ${LCOV_PATH} --output-directory ./coverage"
echo "Note: to run this you may need to install genhtml. In OSX it is 'brew install lcov'"

./node_modules/.bin/css-coverage --style ${CSS_PATH} --html ${RAW_PATH} --lcov ${LCOV_PATH} ${DEBUG_FLAG1} ${DEBUG_FLAG2}
