#!/bin/bash

cd "$(dirname "$0")/.."

source ./script/bootstrap || exit 1

arg1=$1

# Pull in the BOOK_CONFIGS and RECIPE_NAMES
source ./books.txt || exit 1

if [ ! "${arg1}" == "" ]
then
  RECIPE_NAMES=(${arg1})
fi


sassBin="$(npm bin)/node-sass"
outputDir="./recipes/output/"

for recipeName in "${RECIPE_NAMES[@]}"
do

  sassFile="./recipes/books/${recipeName}/book.scss"
  inputSassFile="./recipes/books/${recipeName}/${recipeName}.scss"
  cssFile="${outputDir}/${recipeName}.css"

  do_progress_quiet "Generating ${cssFile}" \
    ${sassBin} --source-map true --output-style nested ${sassFile} ${cssFile}
done

do_progress_quiet "Generating CSS manifest" \
  ./script/build-manifest
