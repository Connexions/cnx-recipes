@import '../../mixins/_all';

//Import book config file
@import './_config';

:pass(0) {
  //Some modifications to be done to the book before any collation
  @include modify_titlePreface();
  @include modify_spanWrapTitles();
  @include modify_simLinkTarget();

  // @include utils_hasSolution();
  @include modify_note($artConnectionNote);
  @include modify_note($careerConnectionNote);
  @include modify_note($everydayConnectionNote);
  @include modify_note($evolutionConnectionNote);
  @include modify_note($scientificMethodConnectionNote);
  @include modify_note($linkToLearningNote);
  @include modify_note($connectionApCoursesNote);
  @include modify_note($teacherSupportNote);
  @include modify_note($visualConnectionNote);
  @include modify_note($apEverydayNote);
  @include modify_note($apSciencePracticesNote);
  @include modify_GenericNote();
  //the metadata has been moved to the content, remove it from the metadata
  @include modify_trash('[data-type="metadata"] > [data-type="description"]');
  @include modify_trash('div.missing-exercise');
}
:pass(1) {
  // These have no dependencies so I do not know why they require having to be here
  // (as opposed to being right at the top of :pass(0) )
  // but the fact that the list is inside a note seems to be the culprit.
  // maybe the modify_note code runs first and makes a copy of the element `::before`
  // This list code runs? (even though the listMakeLabelVisible was listed above modify_note)

  //the following two notes need to be in a different pass because they are nested inside modify_note($apSciencePracticesNote) that gets processed as well.
  @include modify_note($activityNote);
  @include modify_note($thinkNote);

  @include modify_wrapExercises(); // no dependencies
  @include modify_wrapLists(); // no dependencies

  //Come up with mixins for common numbering schemes as per Phil's suggestion
  @include count_countChapters(chapter);
  @include number_numberChapters($chapterTitleContent);
  @include count_countAppendices(appendix);
  @include number_numberAppendices($appendixTitleContent);
  @include count_countSections(section);
  @include number_numberSections($sectionTitleContent);


  @include count_countTerms(term);
  @include reference_refPageIDStringAs(pageID);
  @include modify_prepIndexTerms(term, pageID);

  @include reference_refSectionHeaderNodeAs(sectionHeaderNode);
  @include compose_createChapterComposites($chapterCompositePages, sectionHeaderNode);
}
:pass(2) {
  //After: ???
  @include reference_refSectionHeaderNodeAs(sectionHeaderNode);
  @include reference_refSectionHeaderStringAs(sectionHeaderString);
  @include compose_prepBookComposites($bookCompositePages, sectionHeaderNode, sectionHeaderString);

  //After: createChapterComposites
  @include count_countEOCExercises(exercise, '[data-type="chapter"]');
  @include number_numberEOCExercises($exerciseTitleContent, $exerciseTitleContent);
}
:pass(3) {
  //After: createChapterComposites, numberEOCExercises
  @include count_countExercises(exerciseAll);
  // @include link_linkToProblemsFromSolutionsEOC();

  //After: prepBookComposites
  @include reference_refChapterHeaderNodeAs(chapterHeaderNode);
  @include compose_prepChapterAreas($bookCompositePages, chapterHeaderNode);

}
:pass(4) {
  //Only move solutions after exercises/solutions are numbered
  @include reference_refSectionHeaderNodeAs(sectionHeaderNode);
  // @include compose_createEOBSolutions($chapterCompositePages, $pageSolutions, sectionHeaderNode);

  //After: prepBookComposites, prepChapterAreas
  @include compose_createBookComposites($bookCompositePages);
}
:pass(5) {
  //After: prepIndexTerms, createBookComposites
  @include modify_addIndexSymbolGroup("index", $symbolsSectionTitle);

  //After: composite page creation
  @include count_countChapters(chapter);
  @include count_countAppendices(appendix);
  @include count_countEOCExercises(exercise, '[data-type="chapter"]');

  @include link_setTargetLabels($targetLabels);
  @include link_setLinkLabels();

  @include reference_refBookMetadataNodeAs(bookMetadata);
  @include modify_compositeMetadata(bookMetadata);

  //After: createChapterComposites, createEOCSolutions, createBookComposites
  @include compose_titleEOCComposites($chapterCompositePages);
  @include compose_titleEOBComposites($bookCompositePages);


  //After: createChapterComposites, createEOCSolutions, createBookComposites
  @include modify_chapterAutoID();

  @include count_countTables(table);
  @include count_countFigures(figure);
  @include number_setCaptions($setTableCaption, $captionTableNumber, $captionTableNumberAp);
  @include number_setCaptions($setFigureCaption, $captionFigNumber, $captionFigNumberAp);
  @include modify_retitleHeaders();
}
:pass(6) {
  @include modify_trash('.os-index-link-separator:last-child');
  @include modify_retitleCompositeMetadata();
}
:pass(7) {
  //After: All metadata tasks are completed
  @include modify_suppressURI();

  @include toc_prepTOCElements();
}
:pass(8) {
  @include toc_putTOCElements();
}
:pass(9) {
  @include toc_navTOCUnwrap();
}
:pass(100) {
  @include utils_clearTrash();
}
